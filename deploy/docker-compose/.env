# Shelly Manager Docker Compose Environment Configuration
# Copy this file to .env and modify values as needed

# ==============================================================================
# CONTAINER REGISTRY CONFIGURATION
# ==============================================================================

# Container registry and image tags
REGISTRY=ghcr.io/ginsys
TAG=latest

# ==============================================================================
# DATABASE CONFIGURATION (12-Factor App Compliance)
# ==============================================================================

# Database provider: sqlite, postgresql, mysql
DATABASE_PROVIDER=sqlite

# Database path/connection string
DATABASE_PATH=/data/shelly.db

# For PostgreSQL: postgresql://user:pass@host:port/dbname?sslmode=disable
# For MySQL: user:pass@tcp(host:port)/dbname?charset=utf8mb4&parseTime=True&loc=Local
# DATABASE_DSN=

# Connection pool settings
# DATABASE_MAX_OPEN_CONNS=25
# DATABASE_MAX_IDLE_CONNS=5
# DATABASE_CONN_MAX_LIFETIME=300
# DATABASE_CONN_MAX_IDLE_TIME=600

# ==============================================================================
# WEB SERVER CONFIGURATION
# ==============================================================================

# HTTP server configuration
SERVER_PORT=8080
SERVER_HOST=0.0.0.0

# ==============================================================================
# DEVICE DISCOVERY CONFIGURATION
# ==============================================================================

# Enable/disable device discovery
DISCOVERY_ENABLED=true

# Networks to scan for devices (comma-separated for multiple networks)
# Examples: 192.168.1.0/24 or 192.168.1.0/24,10.0.0.0/24
DISCOVERY_NETWORKS=192.168.1.0/24

# Discovery interval in seconds
DISCOVERY_INTERVAL=300

# Discovery timeout per device in seconds
DISCOVERY_TIMEOUT=5

# Enable mDNS and SSDP discovery
DISCOVERY_ENABLE_MDNS=true
DISCOVERY_ENABLE_SSDP=true

# Maximum concurrent device scans
DISCOVERY_CONCURRENT_SCANS=20

# ==============================================================================
# DEVICE PROVISIONING CONFIGURATION
# ==============================================================================

# Automatic provisioning settings
PROVISIONING_AUTO=false
PROVISIONING_INTERVAL=600

# Default device authentication settings
PROVISIONING_AUTH_ENABLED=false
PROVISIONING_AUTH_USER=admin
# PROVISIONING_AUTH_PASSWORD=

# Cloud and MQTT settings
PROVISIONING_CLOUD_ENABLED=false
PROVISIONING_MQTT_ENABLED=false
# PROVISIONING_MQTT_SERVER=

# Device naming pattern
PROVISIONING_DEVICE_NAME_PATTERN="shelly_{type}_{mac}"

# ==============================================================================
# API CONFIGURATION (For Provisioner Agent)
# ==============================================================================

# API server URL (how provisioner connects to manager)
API_URL=http://localhost:8080

# API authentication key (if required)
# API_KEY=

# API request timeout in seconds
API_TIMEOUT=30

# Retry configuration
API_RETRY_ATTEMPTS=3
API_RETRY_DELAY=5

# ==============================================================================
# DHCP RESERVATION CONFIGURATION
# ==============================================================================

# Network for DHCP reservations
DHCP_NETWORK=192.168.1.0/24
DHCP_START_IP=192.168.1.100
DHCP_END_IP=192.168.1.199
DHCP_AUTO_RESERVE=false

# ==============================================================================
# OPNSENSE FIREWALL INTEGRATION
# ==============================================================================

# OPNSense integration settings
OPNSENSE_ENABLED=false
# OPNSENSE_HOST=
# OPNSENSE_PORT=443
# OPNSENSE_API_KEY=
# OPNSENSE_API_SECRET=
OPNSENSE_AUTO_APPLY=false

# ==============================================================================
# LOGGING CONFIGURATION (12-Factor App Compliance)
# ==============================================================================

# Log level: debug, info, warn, error
LOG_LEVEL=info

# Log format: text, json (json recommended for production)
LOG_FORMAT=json

# Log output: stdout, stderr, or file path (stdout recommended for containers)
LOG_OUTPUT=stdout

# ==============================================================================
# RUNTIME CONFIGURATION
# ==============================================================================

# Gin mode: debug, release
GIN_MODE=release

# ==============================================================================
# METRICS AND MONITORING
# ==============================================================================

# Enable metrics collection
METRICS_ENABLED=true

# Prometheus metrics
METRICS_PROMETHEUS_ENABLED=true
METRICS_PROMETHEUS_PORT=9090

# Metrics collection interval in seconds
METRICS_COLLECTION_INTERVAL=300

# Metrics retention in days
METRICS_RETENTION_DAYS=30

# HTTP metrics
METRICS_ENABLE_HTTP_METRICS=true
METRICS_ENABLE_DETAILED_TIMING=false

# ==============================================================================
# NOTIFICATION SYSTEM
# ==============================================================================

# Enable notifications
NOTIFICATIONS_ENABLED=true

# Email configuration (optional)
# NOTIFICATIONS_EMAIL_SMTP_HOST=
# NOTIFICATIONS_EMAIL_SMTP_PORT=587
# NOTIFICATIONS_EMAIL_SMTP_USER=
# NOTIFICATIONS_EMAIL_SMTP_PASSWORD=
# NOTIFICATIONS_EMAIL_FROM_ADDRESS=
NOTIFICATIONS_EMAIL_TLS=true

# Notification thresholds
NOTIFICATIONS_CRITICAL_DRIFT_COUNT=5
NOTIFICATIONS_WARNING_DRIFT_COUNT=10
NOTIFICATIONS_MAX_PER_HOUR=20

# ==============================================================================
# AUTO-RESOLUTION CONFIGURATION
# ==============================================================================

# Automatic issue resolution
RESOLUTION_AUTO_FIX_ENABLED=false
RESOLUTION_SAFE_MODE=true
RESOLUTION_APPROVAL_REQUIRED=true

# ==============================================================================
# DEVELOPMENT SETTINGS
# ==============================================================================

# Uncomment for development mode
# LOG_LEVEL=debug
# LOG_FORMAT=text
# GIN_MODE=debug

# ==============================================================================
# SECURITY CONSIDERATIONS
# ==============================================================================

# - Never commit .env files with real secrets to version control
# - Use Docker Secrets or Kubernetes Secrets in production
# - Rotate API keys and passwords regularly
# - Enable authentication for production deployments
# - Use TLS/HTTPS for production web access
# - Review network access and firewall rules

# ==============================================================================
# DOCKER COMPOSE USAGE EXAMPLES
# ==============================================================================

# Development:
# docker-compose -f docker-compose.yml -f docker-compose.dev.yml up --build

# Production:
# docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# Custom environment:
# docker-compose --env-file .env.production up -d